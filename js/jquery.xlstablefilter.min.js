(function(e){var t;e.widget("ui.xlsTableFilter",{options:{width:400,height:550,maxHeight:e(window).height(),ignoreCase:true,checkStyle:"default",ignoreColumns:[],onlyColumns:null,rowsDisplay:"xlsTableFilterRowsDisplay"},filters:{},elid:null,_create:function(){t=this;var n=t.element,r=e(n).find("th");t.elid=n.prop("id");t.filters[t.elid]={};e.each(r,function(n,r){var i=t.options.onlyColumns==null&&jQuery.inArray(n,t.options.ignoreColumns)==-1||jQuery.inArray(n,t.options.onlyColumns)!==-1?true:false;if(i==true){e(this).addClass("xlsFilterHeader").click(function(n){t._openFilter(e(this))})}else{e(this).addClass("xlsNoFilterHeader")}});t._printRowsDisplayed()},_openFilter:function(n){var r=n.index()+1;var i=t._getFilterContent(n);var s=t._createDialogDiv("divXlsFilter","Filter - "+n.text(),i);t._setupFilter();e(s).dialog({resizable:false,autoOpen:true,width:t.options.width,height:t.options.height,maxHeight:t.options.maxHeight,modal:true,show:400,hide:400,buttons:{Filter:function(){t._filterTable(r);e(this).dialog("close")},Cancel:function(){e(this).dialog("close");return false}},close:function(){e(this).dialog("destroy");e(this).remove()}})},_getFilterContent:function(n){var r=n.index()+1;var i=new Array;e.each(e(t.element).find("tr td:nth-of-type("+r+")"),function(t,n){i[i.length]=e(n).text()});i=t.sortUnique(i);var s='<form id="xlsFilterForm">';s=s+'<div>Text Search <input type="text" id="filterSearch" style="width: 200px;"></div>';s=s+'<div id="xlsFilterAllNone"><span id="xlsFilterAll">All</span> | <span id="xlsFilterNone">None</span></div>';s=s+'<div id="xlsFilterRows">';e.each(i,function(e,n){s=s+t._addFilterRow(n,r)});s=s+"</div></form>";return s},_setupFilter:function(){e("#xlsFilterAll").click(function(){e.each(e("div.xlsFilterRow"),function(){t.checkRow(e(this),true)})});e("#xlsFilterNone").click(function(){e.each(e("div.xlsFilterRow"),function(){t.checkRow(e(this),false)})});e("div.xlsFilterRow input").on("click",function(e){e.stopPropagation()});e("div.xlsFilterRow").click(function(){t.checkRow(e(this))});e("#filterSearch").blur(t._filterBySearchField);e("#filterSearch").focus(t._filterBySearchField);e("#filterSearch").keyup(t._filterBySearchField)},_addFilterRow:function(e,n){var r=e.length==0?"<i><blank></i>":e;e=t._adjustCase(e);if(t.filters[t.elid]["col"+n]){var i=jQuery.inArray(e,t.filters[t.elid]["col"+n])==-1?false:true}else{var i=true}var s='<div class="xlsFilterRow"><input type="checkbox" style="'+(t.options.checkStyle=="default"?"":"display: none;")+'" value="'+e+'" '+(i==true?"checked ":"")+'name="selFilter[]">'+(t.options.checkStyle=="default"?"":'<div class="xlsFilterCheck xlsFilterCheckO'+(i==true?"n":"ff")+'"></div>')+"<span>"+r+"</span></div>";return s},checkRow:function(n,r){var i=e(n).find("input");r=arguments.length==2?r:i.prop("checked")==true?false:true;i.prop("checked",r);if(t.options.checkStyle=="custom"){var s=n.find(".xlsFilterCheck");s.addClass(r==true?"xlsFilterCheckOn":"xlsFilterCheckOff");s.removeClass(r==true?"xlsFilterCheckOff":"xlsFilterCheckOn")}},_filterBySearchField:function(){if(e("#filterSearch").val().length==0){e("div.xlsFilterRow").show()}else{e.each(e("div.xlsFilterRow input"),function(){if(e(this).val().toLowerCase().indexOf(e("#filterSearch").val().toLowerCase())===-1){e(this).parent().hide()}else{e(this).parent().show()}})}},_createDialogDiv:function(t,n,r){if(e("#"+t).length>0){e("#"+t).html(r).attr("title",n)}else{e("body").append('<div id="'+t+'" title="'+n+'" style="display: none;">'+r+"</div>")}return e("#"+t)},_filterTable:function(n){var r="col"+n;t.filters[t.elid][r]=new Array;e.each(e("div.xlsFilterRow input:checked"),function(){t.filters[t.elid][r][t.filters[t.elid][r].length]=e(this).val()});if(e("div.xlsFilterRow input").not(":checked").length===0){t.element.find("thead th:nth-of-type("+n+")").removeClass("xlsFilteredColumn")}else{t.element.find("thead th:nth-of-type("+n+")").addClass("xlsFilteredColumn")}e.each(t.element.find("tbody tr"),function(){var n=e(this);var r=true;n.show();e.each(t.filters[t.elid],function(e,i){var s=e.substr(3);if(r==true){if(jQuery.inArray(t._adjustCase(n.children("td:nth-of-type("+s+")").text()),i)==-1){n.hide();return false}}})});t._printRowsDisplayed()},_printRowsDisplayed:function(){if(t.options.rowsDisplay!==false){var n=t.element.find("tbody tr:visible").length;var r=t.element.find("tbody tr").length;var i=typeof t.options.rowsDisplay=="object"?t.options.rowsDisplay:e("#"+t.options.rowsDisplay);i.html("Displaying "+n+(n!=r?" of "+r+" row"+(r==1?"":"s"):" row"+(n==1?"":"s"))+".")}},_adjustCase:function(e){return t.options.ignoreCase==true?e.toLowerCase():e},sortUnique:function(e){e.sort(function(e,n){e=t._adjustCase(e);n=t._adjustCase(n);if(e==n)return 0;return e>n?1:-1});var n=[e[0]];for(var r=1;r<e.length;r++){if(t._adjustCase(e[r-1])!==t._adjustCase(e[r])){n.push(e[r])}}return n},_setOption:function(e,t){options.key=t}})})(jQuery)